import"./__uno-9d578755.js";import{an as D,V as c,aq as k,S as A,b as M,A as j,f as x,W as z,bc as T}from"./three.module-b52a2031.js";import{O as W}from"./OBJLoader-7809e956.js";const F={type:"change"};class C extends D{constructor(R,K){super(),this.object=R,this.domElement=K,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const t=this,d=1e-6,p=new k,v=new c;this.tmpQuaternion=new k,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new c(0,0,0),this.rotationVector=new c(0,0,0),this.keydown=function(e){if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1;break}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0;break}this.updateMovementVector(),this.updateRotationVector()},this.pointerdown=function(e){if(this.dragToLook)this.status++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1;break}this.updateMovementVector()}},this.pointermove=function(e){if(!this.dragToLook||this.status>0){const o=this.getContainerDimensions(),i=o.size[0]/2,b=o.size[1]/2;this.moveState.yawLeft=-(e.pageX-o.offset[0]-i)/i,this.moveState.pitchDown=(e.pageY-o.offset[1]-b)/b,this.updateRotationVector()}},this.pointerup=function(e){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0;break}this.updateMovementVector()}this.updateRotationVector()},this.update=function(e){const o=e*t.movementSpeed,i=e*t.rollSpeed;t.object.translateX(t.moveVector.x*o),t.object.translateY(t.moveVector.y*o),t.object.translateZ(t.moveVector.z*o),t.tmpQuaternion.set(t.rotationVector.x*i,t.rotationVector.y*i,t.rotationVector.z*i,1).normalize(),t.object.quaternion.multiply(t.tmpQuaternion),(v.distanceToSquared(t.object.position)>d||8*(1-p.dot(t.object.quaternion))>d)&&(t.dispatchEvent(F),p.copy(t.object.quaternion),v.copy(t.object.position))},this.updateMovementVector=function(){const e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",y),this.domElement.removeEventListener("pointerdown",w),this.domElement.removeEventListener("pointermove",l),this.domElement.removeEventListener("pointerup",u),window.removeEventListener("keydown",f),window.removeEventListener("keyup",S)};const l=this.pointermove.bind(this),w=this.pointerdown.bind(this),u=this.pointerup.bind(this),f=this.keydown.bind(this),S=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",y),this.domElement.addEventListener("pointerdown",w),this.domElement.addEventListener("pointermove",l),this.domElement.addEventListener("pointerup",u),window.addEventListener("keydown",f),window.addEventListener("keyup",S),this.updateMovementVector(),this.updateRotationVector()}}function y(r){r.preventDefault()}const H="/assets/city-3bf9961e.obj",{innerWidth:L,innerHeight:g}=window,s=new A,h=new M(45,L/g,.1,1e3);h.position.set(-80,60,200);h.lookAt(s.position);const Q=new j(6710886);s.add(Q);const m=new x(10066329);m.position.set(0,200,200);m.castShadow=!0;s.add(m);let E=!1;const q=new W;q.load(H,r=>{s.add(r),E=!0});const n=new z({antialias:!0});n.setSize(L,g);n.shadowMap.enabled=!0;document.body.appendChild(n.domElement);const U=new T,a=new C(h,n.domElement);a.movementSpeed=25;a.rollSpeed=Math.PI/12;a.autoForward=!1;a.dragToLook=!0;const V=()=>{E&&a.update(U.getDelta()),requestAnimationFrame(V),n.render(s,h)};V();
